name: CICD Pipeline

on:
  push:
    branches: [ main ]

jobs:
  compile:
    runs-on: self-hosted

    steps:
    - name: Checkout Code
      uses: actions/checkout@v6

    - name: Print Hello World
      run: echo "Hello from github actions"

  security-check:
    runs-on: self-hosted
    # needs: compile

    steps:
    - name: Checkout Code
      uses: actions/checkout@v6

    - name: Install Trivy
      run: |
        sudo apt-get update
        sudo apt-get install -y wget apt-transport-https gnupg lsb-release
        wget -qO - https://aquasecurity.github.io/trivy-repo/deb/public.key | sudo apt-key add -
        echo "deb https://aquasecurity.github.io/trivy-repo/deb $(lsb_release -sc) main" | sudo tee -a /etc/apt/sources.list.d/trivy.list
        sudo apt-get update
        sudo apt-get install -y trivy

    - name: Run Trivy FS Scan
      run: trivy fs --format table -o trivy-report.txt .

    - name: gileaks scan
      uses: zricethezav/gitleaks-action@v1.3.0
      with:
        args: "--path=. --report-path=gitleaks-report.json --report-format=json"

    